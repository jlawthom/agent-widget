<html>

<head>
  <title>Translate Widget Example</title>
  <!-- BEGIN LivePerson Monitor. -->
  <!-- END LivePerson Monitor. -->
  <script type="text/javascript" charset="utf8" src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/example2.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/watson-translation-wrapper.js"></script>
  <style>
    /* centered columns styles */

    .row-centered {
      text-align: center;
    }

    .col-centered {
      display: block;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }

    .LTRStyle {
      display: none !important;
    }
  </style>
</head>

<body cz-shortcut-listen="true">
  <!-- Start of Container -->
  <div class="container">
    <div class="row row-centered">
      <div class="col-md-12 page-header">
        <h2 translate="no" class="text-shade">Translation Widget</h2>
      </div>
    </div>
    <!-- Visitor Chat Area -->
    <div class="row row-centered">
      <div class="col-md-4 col-centered"></div>
      <div class="col-md-4 col-centered">
        <div>
          <div class="client-language">
            Customer language:
            <!-- Client language dropdown -->
            <select id="selectClientLanguage" style="width: 100px;" onchange="clientLanguageSelectionChanged()">
            </select>
          </div>
          <div class="agent-language">
            Agent language:
            <!-- Agent language dropdown -->
            <select id="selectAgentLanguage" style="width: 100px;" onchange="agentLanguageSelectionChanged()">
            </select>
          </div>
        </div>
      </div>
      <div class="col-md-4 col-centered"></div>
    </div>
    <br>
    <!-- End of Visitor Chat Area -->
    <!-- Visitor Chat Area -->
    <div class="row row-centered">
      <div class="col-md-4 col-centered"></div>
      <div class="col-md-4 col-centered">
        <div translate="no" class="text-shade">
          <h3>Consumer</h3>
        </div>
        <div>
          <textarea id="visitorChat" rows="5" class="commandInput" disabled=""></textarea>
        </div>
        <div><button type="button" id="previousButton" class="btn button-translate" onclick="translatePrevious()">Load
            previous message</button></div>
        <div id="visitorChat2" style="display: none;"></div>
      </div>
      <div class="col-md-4 col-centered"></div>
    </div>
    <br>
    <!-- End of Visitor Chat Area -->
    <!-- Start of Agent Chat Area -->
    <div class="row row-centered">
      <div class="col-md-4 col-centered"></div>
      <div class="col-md-4 col-centered">
        <div translate="no" class="text-shade">
          <h3>Agent</h3>
          <textarea id="agentChat" rows="5" class="commandInput"></textarea>
          <br>
          <br>
          <button type="button" class="btn btn-block btn-default button-translate"
            onclick="translateChat()">Translate</button>
        </div>
        <div id="agentChatTranslated" style="display: none;"></div>
      </div>
      <div class="col-md-4 col-centered"></div>
    </div>
    <!-- Start of Agent Chat Area -->
  </div>
  <!-- End of Container -->
  <script>
    var skill;
    const DEFAULT_AGENT_LANGUAGE = "en";
    var translation = {
      from: null,
      to: DEFAULT_AGENT_LANGUAGE,
    };
    var clientChatLine = "";
    var clientChatSelector = "#selectClientLanguage";
    var agentChatSelector = "#selectAgentLanguage";
    var languageModels;
    var SDK = lpTag.agentSDK;
    var historyIndex = null;
    SDK.init();

    var visitorChatHistory = [];

    var updateCallback = function(data) {
            // called each time the value is updated; if there is an existing value when bind
            //is called - this callback will be called with the existing value
            var newData = data.newValue.lines.filter(line => line.source === 'visitor')

            visitorChatHistory = visitorChatHistory.concat(newData);

            console.log("newData");
            console.log(newData);

            // if(newData.length !== 0) {
            //     translateVisitor(onCompleteVisitor);

            // }
        };


        var notifyWhenDone = function(err) {
            if (err) {
                // Do something with the error
            }
            // called when the bind is completed successfully,
            // or when the action terminated with an error
        };

        //path to the chat transcript from the sdk
        var pathToData = "chatTranscript";
        // bin the chat transcript so it will listen for new chatlines
        SDK.bind(pathToData, updateCallback, notifyWhenDone);
  </script>



</body>

</html>